@model SafetyAndSecurityForNSI.Models.DoctorsEntryModel

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<h4 class="text-center">Doctors Info Entry</h4>
<div id="DivForDoctorEntry">
    <div class="row">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="col-md-12">
            <div class="col-md-6 form-horizontal form-widget">
                <div class="form-group">
                    @Html.Label("Doctor Name", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        @Html.EditorFor(model => model.DoctorName, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.DoctorName, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.Label("Degree One", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        @Html.EditorFor(model => model.DegreeOne, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.DegreeOne, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.Label("Degree Two", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        @Html.EditorFor(model => model.DegreeTwo, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.DegreeTwo, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.Label("Degree Three", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        @Html.EditorFor(model => model.DegreeThree, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.DegreeThree, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <div class="col-md-6 form-horizontal form-widget">
                <div class="col-md-6 col-sm-5 col-xs-8 divForPic" id="divForPic-0" style="margin-left:37%">
                    <span id="UserImgClose-0" style="display:none;">
                        <img src="~/Image/Blank/close_pic.png" class="previewImgClose" id="UserImgClose-0" data-count="0" />
                    </span>
                    <div id="imgPreview-0" class="imgPreview"></div>
                    <div id="imgUpload-0" class="image-uploader">
                        <input type="file" name="files" id="file-0" class="inputfile inputfile-4" data-count="0" style="display:none;" />
                        <label for="file-0" id="lbl-0" class="lblForPics">
                            <span style="font-size: 26px;padding-top:1em;display:block;" class="lbl_Span_plus">+</span>
                            <span style="font-size: 15px;font-weight:bold;">Add Photos</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12" style="margin-top:50px;">
            <div class="col-md-6  form-horizontal form-widget">
                <div class="form-group">
                    @Html.Label("Training Institute", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        @Html.EditorFor(model => model.TrainingInstitute, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.TrainingInstitute, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.Label("Training Period", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        @Html.EditorFor(model => model.TrainingPeriod, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.TrainingPeriod, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.Label("Special Training", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        @Html.EditorFor(model => model.SpecialTraining, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.SpecialTraining, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.Label("BMA Membership No", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        <input type="number" id="BMAMembershipNo" name="BMAMembershipNo" pattern="^[0-6]{6}$" class="form-control"  />
                        @Html.ValidationMessageFor(model => model.BMAMembershipNo, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.Label("BMA Brance Code", htmlAttributes: new { @class = "control-label col-md-6" })
                    <div class="col-md-6">
                        @Html.EditorFor(model => model.BranceCode, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.BranceCode, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
            <div class="col-md-6 form-horizontal form-widget">
                <div class="form-group">
                    @Html.Label("Membership Category", htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-8">
                       @Html.DropDownListFor(model => model.MembershipCategory, new SelectList(ViewBag.MemberType, "MemberCategory", "MemberCategory"), ".....Select Memberships Type.....", new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.MembershipCategory, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.Label("Bcs Registration No", htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.BcsRegNo, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.BcsRegNo, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.Label("National ID", htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-8">
                        <input type="number" id="NID" name="NID" pattern="^[0-6]{17}$" class="form-control"  />
                        @Html.ValidationMessageFor(model => model.NID, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.Label("Gender", htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-8">
                        @Html.DropDownListFor(model => model.Gender, new SelectList(ViewBag.GenderCategory, "Sex", "Sex"), ".....Select Gender.....", new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Gender, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.Label("Marital Status", htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.MaritalStatus, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.MaritalStatus, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" style="margin-top:50px;">
        <div class="col-md-offset-2 col-md-6">
            <span class="btn btn-success" id="DoctorEntrySave"><i class="fa fa-save"></i> Save</span>
            <span class="btn btn-warning" id="DoctorEntryRefresh"><i class="fa fa-refresh"></i> Refresh</span>
            <span class="btn btn-danger" id="DoctorEntryCancel"><i class="fa fa-close"></i> Cancel</span>
        </div>
    </div>

</div>
<div class="row">
    @Html.ActionLink("Back to List", "Index")
</div>
<script>
    var allMainFile = [];
    var allFileCount = [];
    var id;
    var PictureName;
    $('#DoctorEntryRefresh').click(function () {
        location.reload();
    });
    $('#DoctorEntryCancel').click(function () {
        location.href = '@Url.Action("Index", "DoctorsEntry")';
    });

    $(".divForPic").on('change', '.inputfile-4', function (e) {
        id = $(this).data("count");
        var countFiles = $("#file-" + id)[0].files.length;
        var imgPath = $("#file-" + id)[0].value;
        var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase();
        var image_holder = $("#imgPreview-" + id);
        var files = e.target.files;
        image_holder.empty();
        if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
            if (typeof (FileReader) != "undefined") {
                allFileCount.push(id);
                allMainFile[id] = files[0];
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("<img />", { "src": e.target.result }).appendTo(image_holder);
                }
                $("#imgUpload-" + id).hide();
                $("#UserImgClose-" + id).show();
                image_holder.show();
                $("#file-" + id).hide();
                $("#lblfile-" + id).hide();
                $("#PictureName").val($("#file-" + id)[0].files[0]);
                reader.readAsDataURL($("#file-" + id)[0].files[0]);
                $(".lbl_Span_plus").text("+");
                id++;
            } else {
                alert("This browser does not support FileReader.");
            }
        } else {
            alert("Pls select only images");
        }
    });

    $(".divForPic").on('click', ".previewImgClose", function (e) {
        var id = $(this).data("count");
        allMainFile[id] = "";
        $("#imgPreview-" + id).empty();
        $("#imgPreview-" + id).hide();
        $("#UserImgClose-" + id).hide();
        $("#imgUpload-" + id).show();
    });

    var DoctorValidation = $("#DivForDoctorEntry").kendoValidator({
        rules: {
            Image: function (select) {
                if (select.is("[name=files]") && $("#file-0").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            DoctorName: function (input) {
                if (input.is("[name=DoctorName]") && $("#DoctorName").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            NID: function (input) {
                if (input.is("[name=NID]") && $("#NID").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            DegreeOne: function (input) {
                if (input.is("[name=DegreeOne]") && $("#DegreeOne").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            DegreeTwo: function (input) {
                if (input.is("[name=DegreeTwo]") && $("#DegreeTwo").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            DegreeThree: function (input) {
                if (input.is("[name=DegreeThree]") && $("#DegreeThree").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            TrainingInstitute: function (input) {
                if (input.is("[name=TrainingInstitute]") && $("#TrainingInstitute").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            TrainingPeriod: function (input) {
                if (input.is("[name=TrainingPeriod]") && $("#TrainingPeriod").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            BMAMembershipNo: function (input) {
                if (input.is("[name=BMAMembershipNo]") && $("#BMAMembershipNo").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            BranceCode: function (input) {
                if (input.is("[name=BranceCode]") && $("#BranceCode").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            MembershipCategory: function (select) {
                if (select.is("[name=MembershipCategory]") && $("#MembershipCategory").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            BcsRegNo: function (input) {
                if (input.is("[name=BcsRegNo]") && $("#BcsRegNo").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            Gender: function (select) {
                if (select.is("[name=Gender]") && $("#Gender").val() === "") {
                    return false;
                } else {
                    return true;
                }
            },
            MaritalStatus: function (input) {
                if (input.is("[name=MaritalStatus]") && $("#MaritalStatus").val() === "") {
                    return false;
                } else {
                    return true;
                }
            }


        },
        messages: {
            Image: "Select Image",
            DoctorName: "*",
            NID: "*",
            DegreeOne: "*",
            DegreeTwo: "*",
            DegreeThree: "*",
            TrainingInstitute: "*",
            TrainingPeriod: "*",
            BMAMembershipNo: "*",
            BranceCode: "*",
            MembershipCategory: "*",
            BcsRegNo: "*",
            Gender: "*",
            MaritalStatus: "*"
        }
    }).data("kendoValidator");


    $("#DoctorEntrySave").click(function () {
        if (DoctorValidation.validate()) {
            var sendData = new FormData();
            sendData.append("DoctorName", $("#DoctorName").val());
            sendData.append("DegreeOne", $("#DegreeOne").val());
            sendData.append("DegreeTwo", $("#DegreeTwo").val());
            sendData.append("DegreeThree", $("#DegreeThree").val());
            sendData.append("TrainingInstitute", $("#TrainingInstitute").val());
            sendData.append("TrainingPeriod", $("#TrainingPeriod").val());
            sendData.append("SpecialTraining", $("#SpecialTraining").val());
            sendData.append("BMAMembershipNo", $("#BMAMembershipNo").val());
            sendData.append("BranceCode", $("#BranceCode").val());
            sendData.append("MembershipCategory", $("#MembershipCategory").val());
            sendData.append("BcsRegNo", $("#BcsRegNo").val());
            sendData.append("NID", $("#NID").val());
            sendData.append("Gender", $("#Gender").val());
            sendData.append("MaritalStatus", $("#MaritalStatus").val());
            for (var i = 0; i < allMainFile.length; i++) {
                sendData.append("files[" + i + "]", allMainFile[i]);
            }
            $.ajax({
                url:'@Url.Action("SaveDoctorEntry", "DoctorsEntry")',
                type:'Post',
                data:sendData,
                contentType: false,
                processData: false,
                success: function (data) {
                    //notification.hide(); notification.setOptions({ autoHideAfter: 5000 });
                    if (data === "Error") {
                        alert("Failed");
                       //notification.show("Adding new citizen was unsuccessful.", "upload-error");

                    } else {
                        //notification.show( "Local Citizen info has been successfully added.", "upload-success");
                        alert("Success");
                    }
                },
                error: function (error) {
                    //notification.hide(); notification.setOptions({ autoHideAfter: 5000 });
                   // notification.show("Upload unsuccessful", "upload-warning");
                    alert("Upload Failed");
                }
            });
        }
    });

</script>
<style>
    input:invalid {
        box-shadow: 0 0 5px 1px red;
    }

    input:focus:invalid {
        outline: none;
    }
    .image-uploader {
        width: 200px;
        height: 200px;
        display: block;
        text-align: center;
    }

    .imgPreview {
        background-color: #e8e4d0;
        position: relative;
        width: 200px;
        height: 200px;
        border: 1px solid #808080;
        display: none;
        overflow: hidden;
        margin-bottom:20px;
    }

        .imgPreview img {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
            display: block;
            max-width: 90%;
            height: auto;
        }

    .lblForPics {
        text-align: center;
        max-width: 90%;
        width: 200px;
        height: 200px;
        vertical-align: middle;
        border: 1px dashed blue;
    }

        .lblForPics span {
            color: #083bb5 !important;
        }

    .previewImgClose {
        position: relative;
        width: 30px;
        height: 30px;
        cursor: pointer;
        float: right;
        left: -1.5em;
        bottom:1.5em;
        z-index: 9999;
        margin-top: .3em;
    }
</style>